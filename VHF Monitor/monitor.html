<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>KNRM VHF Monitor</title>

<style>
:root{
  --knrm-orange:#ED6D3A;
  --panel:#141c24;
  --panel-soft:#1b2630;
  --text-soft:#9fb3c8;
}

body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:linear-gradient(180deg,#002b45,#001c2e);
  color:white;
}

body.night{
  background:#000c15;
}

header{
  background:rgba(20,28,36,.95);
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  border-bottom:2px solid var(--knrm-orange);
}

.header-left{
  display:flex;
  align-items:flex-end;
  gap:15px;
}

.header-left img{
  height:38px;
  filter:brightness(0) invert(1);
}

.header-title{
  font-size:18px;
  font-weight:600;
  padding-bottom:4px;
}

.header-right{
  display:flex;
  align-items:flex-end;
  gap:20px;
}

.clock{
  text-align:right;
  font-size:14px;
  line-height:1.3;
  color:var(--text-soft);
}

.clock .time{
  font-size:20px;
  font-weight:600;
  color:white;
}

.header-buttons{
  display:flex;
  gap:10px;
}

.icon-btn{
  width:38px;
  height:38px;
  border-radius:50%;
  border:none;
  background:var(--panel-soft);
  color:white;
  cursor:pointer;
}

.master-btn{
  border:none;
  padding:6px 14px;
  border-radius:20px;
  font-weight:600;
  cursor:pointer;
  background:var(--panel-soft);
  color:white;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:18px;
  padding:20px;
}

.tile{
  background:var(--panel);
  padding:16px;
  border-radius:16px;
  transition:.2s;
  position:relative;
}

.tile.active{
  background:linear-gradient(
    180deg,
    rgba(237,109,58,0.18),
    rgba(20,28,36,0.95)
  );
  border:1px solid rgba(237,109,58,0.6);
  box-shadow:0 0 20px rgba(237,109,58,0.35);
}

.tile-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
}

.toggle{
  width:38px;
  height:20px;
  background:#444;
  border-radius:20px;
  position:relative;
  cursor:pointer;
  transition:.2s;
}

.toggle::after{
  content:"";
  width:16px;
  height:16px;
  background:white;
  border-radius:50%;
  position:absolute;
  top:2px;
  left:2px;
  transition:.2s;
}

.toggle.on{
  background:rgba(237,109,58,0.7);
}

.toggle.on::after{
  left:20px;
}

.status{
  font-size:12px;
  margin-bottom:6px;
  color:var(--text-soft);
}

.status.live{color:#00e676;}
.status.buffering{color:orange;}

.vu{
  height:8px;
  background:#222;
  border-radius:4px;
  overflow:hidden;
  margin:8px 0;
}

.vu-bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00e676,var(--knrm-orange));
}

.controls{
  margin-top:6px;
  font-size:12px;
}

input[type=range]{width:100%;}

:fullscreen header{display:none;}
:fullscreen .controls{display:none;}
:fullscreen .vu{height:14px;}
</style>
</head>

<body>

<header>
  <div class="header-left">
    <img src="knrm-logo-white.png" alt="KNRM">
    <div class="header-title">VHF Monitor</div>
  </div>

  <div class="header-right">
    <div class="clock">
      <div class="time" id="localTime"></div>
      <div id="dateLine"></div>
      <div id="utcLine"></div>
    </div>

    <div class="header-buttons">
      <button id="masterBtn" class="master-btn" onclick="toggleAll()">â–¶ Play all</button>
      <button class="icon-btn" onclick="toggleNightMode()">ðŸŒ™</button>
      <button class="icon-btn" onclick="toggleFullscreen()">â›¶</button>
    </div>
  </div>
</header>

<div class="grid" id="grid"></div>

<script>
const streams=[
 {name:"Scheveningen",url:"https://listen.broadcastify.com/c5r9fnj4qx8k7s0.mp3?nc=65742&xan=xtf9912b41c"},
 {name:"Ter Heijde",url:"https://listen.broadcastify.com/3zf8yrvk1pnwq60.mp3?nc=46783&xan=xtf9912b41c"},
 {name:"Katwijk",url:"https://listen.broadcastify.com/fmbw8yd4vhsg75p.mp3?nc=50199&xan=xtf9912b41c"},
 {name:"Eems Dollard",url:"https://listen.broadcastify.com/c2gxqpy759fdz3s.mp3?nc=62998&xan=xtf9912b41c"},
 {name:"Gooi-, Eem, IJmeer",url:"https://listen.broadcastify.com/w7qfv5y0shtc3d6.mp3?nc=52441&xan=xtf9912b41c"},
 {name:"Texel",url:"https://listen.broadcastify.com/yd67vxw59h4nzrm.mp3?nc=98592&xan=xtf9912b41c"},
 {name:"IJmuiden",url:"https://listen.broadcastify.com/2hwqmync3p8ts41.mp3?nc=88899&xan=xtf9912b41c"},
 {name:"Vlissingen",url:"https://listen.broadcastify.com/f49q2szn16hdm0y.mp3?nc=56146&xan=xtf9912b41c"},
 {name:"Renesse",url:"https://listen.broadcastify.com/5g00vkjn18msdbt.mp3?nc=54023&xan=xtf9912b41c"},
 {name:"Brandaris",url:"https://www.tbandsma.nl:8443/;"},
 {name:"Sneekermeer",url:"https://listen.broadcastify.com/7364218m0knp9jh.mp3?nc=5281&xan=xtf9912b41c"}
];

const grid=document.getElementById("grid");
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
let allPlaying=false;

streams.forEach((stream,index)=>{
  const tile=document.createElement("div");
  tile.className="tile";
  tile.innerHTML=`
    <div class="tile-header">
      <div>${stream.name}</div>
      <div id="toggle${index}" class="toggle"></div>
    </div>
    <div class="status buffering" id="status${index}">Buffering...</div>
    <div class="vu"><div class="vu-bar" id="vu${index}"></div></div>
    <div class="controls">
      Volume 
      <input type="range" min="0" max="1" step="0.01" value="0.7" id="vol${index}">
    </div>
    <audio id="audio${index}" src="${stream.url}" crossorigin="anonymous"></audio>
  `;
  grid.appendChild(tile);
  setupAudio(index);
});

function setupAudio(index){
  const audio=document.getElementById("audio"+index);
  const tile=audio.parentElement;
  const toggle=document.getElementById("toggle"+index);
  const vuBar=document.getElementById("vu"+index);
  const status=document.getElementById("status"+index);
  const vol=document.getElementById("vol"+index);

  toggle.onclick=()=>toggleStream(index);
  vol.oninput=()=>audio.volume=parseFloat(vol.value);

  audio.addEventListener("playing",()=>{
    status.textContent="Live";
    status.className="status live";
    toggle.classList.add("on");
  });

  audio.addEventListener("pause",()=>{
    toggle.classList.remove("on");
  });

  audio.addEventListener("waiting",()=>{
    status.textContent="Buffering...";
    status.className="status buffering";
  });

  const source=audioCtx.createMediaElementSource(audio);
  const analyser=audioCtx.createAnalyser();
  analyser.fftSize=256;
  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  const dataArray=new Uint8Array(analyser.frequencyBinCount);

  function monitor(){
    analyser.getByteFrequencyData(dataArray);
    let sum=0;
    for(let i=0;i<dataArray.length;i++) sum+=dataArray[i];
    let avg=sum/dataArray.length;

    vuBar.style.width=Math.min(avg*2,100)+"%";

    if(avg > 8){
      tile.classList.add("active");
      clearTimeout(tile.timeout);
      tile.timeout=setTimeout(()=>{
        tile.classList.remove("active");
      },1000);
    }

    requestAnimationFrame(monitor);
  }

  audio.onplay=()=>{
    audioCtx.resume();
    monitor();
  };
}

function toggleStream(i){
  const audio=document.getElementById("audio"+i);
  if(audio.paused){audio.play();}
  else{audio.pause();}
}

function toggleAll(){
  const master=document.getElementById("masterBtn");
  const audios=document.querySelectorAll("audio");

  allPlaying=!allPlaying;

  audios.forEach(a=>{
    if(allPlaying){a.play();}
    else{a.pause();}
  });

  master.innerHTML = allPlaying
    ? "â¹ Stop all"
    : "â–¶ Play all";
}

function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

function toggleNightMode(){
  document.body.classList.toggle("night");
}

function updateClock(){
  const now=new Date();
  document.getElementById("localTime").textContent=
    now.toLocaleTimeString("nl-NL",{hour12:false});
  document.getElementById("dateLine").textContent=
    now.toLocaleDateString("nl-NL");
  document.getElementById("utcLine").textContent=
    "UTC "+now.toUTCString().split(" ")[4];
}
setInterval(updateClock,1000);
updateClock();

window.addEventListener("click",()=>audioCtx.resume());
</script>

</body>
</html>